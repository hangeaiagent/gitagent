# GitAgent SSH 终端部署系统 - 使用说明

## 🚀 快速开始

### 1. 安装依赖
```bash
# 运行自动安装脚本
node install.js

# 或者手动安装
npm install
npm install express ws ssh2 cors
```

### 2. 启动系统
```bash
# 方式1: 使用演示脚本（推荐）
node demo-start.js

# 方式2: 使用 npm 脚本
npm run dev-with-proxy

# 方式3: 分别启动
npm run ssh-proxy  # 终端1
npm run dev        # 终端2
```

### 3. 访问系统
打开浏览器访问: http://localhost:5173

## 🔧 功能使用

### 传统智能体部署模式

1. **配置 Claude API Key**
   - 在页面顶部输入您的 Claude API Key
   - 系统会自动保存到本地存储

2. **配置部署信息**
   - GitHub 项目链接
   - 服务器地址和端口
   - SSH 用户名
   - 上传 SSH 私钥文件

3. **开始部署**
   - 点击"开始智能部署"
   - 系统会自动分析项目
   - 多智能体协作执行部署
   - 实时查看部署进度

### SSH 终端部署模式

1. **选择 SSH 终端模式**
   - 点击"SSH终端模式"选项卡

2. **配置连接信息**
   - 服务器地址: 如 `3.93.149.236`
   - 端口: 默认 `22`
   - 用户名: 如 `ec2-user`
   - 私钥文件: 上传 `.pem` 或 `.key` 文件

3. **建立连接**
   - 点击"打开SSH终端"
   - 系统会自动建立安全连接
   - 终端界面会显示连接状态

4. **自动化部署**
   - 在终端连接成功后
   - 输入 GitHub 项目地址
   - 点击"开始自动部署"
   - 系统会自动执行部署步骤

## 🔐 安全特性

### 私钥安全处理
- 私钥文件在浏览器本地读取
- 通过 WebSocket 加密传输到本地代理
- 不会上传到任何远程服务器
- 连接结束后自动清理

### 连接安全
- 本地代理服务器作为中介
- WebSocket 安全连接
- 支持自动重连和心跳检测
- 连接超时保护

## 🤖 智能功能

### 项目类型检测
系统会自动检测以下项目类型：
- React 项目
- Vue 项目
- Angular 项目
- Python 项目
- Node.js 项目
- 静态网站

### 自动化部署步骤
根据项目类型自动生成部署步骤：
1. 准备部署目录
2. 克隆项目代码
3. 安装依赖环境
4. 安装项目依赖
5. 构建项目
6. 启动应用

### 智能错误处理
- 实时错误检测
- AI 驱动的错误分析
- 自动修复建议
- 智能重试机制

## 📊 监控功能

### 实时监控
- 连接状态监控
- 部署进度追踪
- 错误日志记录
- 性能指标统计

### 日志系统
- 详细的操作日志
- 错误堆栈跟踪
- 执行时间统计
- 部署结果记录

## 🔧 故障排除

### 常见问题

**1. SSH 连接失败**
```
错误: SSH 连接失败
解决方案:
- 检查服务器地址和端口
- 确认私钥文件格式正确
- 检查服务器防火墙设置
- 确认用户名正确
```

**2. WebSocket 连接失败**
```
错误: WebSocket 连接失败
解决方案:
- 确认 SSH 代理服务已启动
- 检查端口 3000 是否被占用
- 查看浏览器控制台错误
- 重启代理服务
```

**3. 部署失败**
```
错误: 部署过程失败
解决方案:
- 检查服务器权限设置
- 确认必要软件已安装
- 查看详细错误日志
- 尝试手动执行失败的命令
```

**4. 私钥格式错误**
```
错误: 私钥格式不正确
解决方案:
- 确认私钥文件是 PEM 格式
- 检查文件是否损坏
- 重新生成私钥文件
- 确认私钥权限设置
```

### 调试模式
```bash
# 启动调试模式
DEBUG=ssh-proxy node src/services/sshProxy.js

# 查看详细日志
NODE_ENV=development node demo-start.js
```

## 📝 配置文件

### 环境变量
```bash
# SSH 代理服务端口
SSH_PROXY_PORT=3000

# 前端开发服务器端口
VITE_PORT=5173

# 调试模式
DEBUG=ssh-proxy

# 开发环境
NODE_ENV=development
```

### 配置文件位置
- 前端配置: `vite.config.ts`
- 后端配置: `src/services/sshProxy.js`
- 依赖配置: `package.json`

## 🎯 最佳实践

### 安全建议
1. 定期更换 SSH 密钥
2. 使用强密码保护私钥
3. 限制服务器访问权限
4. 定期更新系统依赖

### 部署建议
1. 在测试环境先验证
2. 备份重要数据
3. 监控部署过程
4. 保留部署日志

### 性能优化
1. 使用 WebGL 加速终端渲染
2. 启用连接复用
3. 合理设置超时时间
4. 定期清理连接缓存

## 📞 技术支持

如果您遇到问题，请：
1. 查看本文档的故障排除部分
2. 检查浏览器控制台错误
3. 查看服务器日志
4. 提交 GitHub Issue

## 🔄 更新日志

### v2.0.0 (当前版本)
- ✨ 新增 SSH 终端部署模式
- 🔐 增强私钥安全处理
- 🖥️ 集成 xterm.js 终端
- 🤖 智能自动化部署
- 📊 实时监控系统

### v1.0.0
- 🤖 多智能体协作部署
- 🧠 Claude AI 集成
- 📈 部署进度可视化
- 🔍 错误分析处理 